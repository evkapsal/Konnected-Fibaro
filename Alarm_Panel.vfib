{"name":"Alarm Panel","type":"virtual_device","properties":{"deviceIcon":1001,"currentIcon":"1001","log":"Device: Running","logTemp":"TxtGreen","mainLoop":"fibaro:debug(\"starting debug\");\nlocal thisId= fibaro:getSelfId();\nfibaro:debug(\"id:\"..thisId);\nlocal ipaddr= fibaro:getValue(thisId,\"IPAddress\");\nfibaro:debug(\"IP:\"..ipaddr);\nlocal port= fibaro:getValue(thisId, \"TCPPort\");\nfibaro:debug(\"Port:\"..port);\nfibaro:log('Device: Running');\nfibaro:debug(os.date(\"%c\"))\nfibaro:call(thisId, \"setProperty\", \"ui.dtime.value\", os.date(\"%c\"));\n\n--fibaro:debug(\"Status\"..konnected);\n\n--ZoneResponse Function\n\nfunction zoneresponse(ipaddr,port,zonenum)\n  konnected= Net.FHttp(ipaddr, port)\n  reqstr= \"/device?pin=\" .. zonenum\n  response= konnected:GET(tostring(reqstr))\n  while tostring(response) ~= nil\n  do\n    if (response) then\n      zonestate= json.decode(response)\n      fibaro:debug(\"Pin:\" .. zonenum .. \",State:\" .. tostring(zonestate[1].state))\n      return zonestate[1].state\n    else\n      fibaro:debug(\"No Response from Konnected\" .. tostring(response))\n      fibaro:sleep(3000)\n    end\n  end\nend\n\t\n\n--Zone1\nzone1= zoneresponse(ipaddr,port,1);\nif (zone1 == 0 or zone1 == 1) then \n  fibaro:debug(\"Zone Status:\"..zone1)\n  local zone1state = zone1\n  if zone1state == 0 then\n    fibaro:call(thisId, \"setProperty\", \"ui.doorId.value\",\"Closed\")\n    fibaro:debug(\"Zone 1 Door is Closed\")\n  elseif zone1state == 1 then\n    fibaro:call(thisId, \"setProperty\", \"ui.doorId.value\",\"Opened\")\n    fibaro:debug(\"Zone 1 Door is Opened\")\n  end\nelse\n  fibaro:debug('[ERROR] Invalid JSON:' .. tostring(zone1))\nend\n\n\n\n\n\n\n--Zone 2\nzone2= zoneresponse(ipaddr,port,2);\nif (zone2 == 0 or zone2 == 1) then\n  fibaro:debug(\"Zone Status:\"..zone2)\n  local zone2state = zone2\n  if zone2state == 0 then\n    fibaro:call(thisId, \"setProperty\", \"ui.motionId.value\",\"Idle\")\n    fibaro:debug(\"Zone 2 no motion detected\")\n  elseif zone2state == 1 then\n    fibaro:call(thisId, \"setProperty\", \"ui.motionId.value\",\"Detected\")\n    fibaro:debug(\"Zone 2 motion detected\")\n  end\n\nend\n\n--Zone3\nzone3= zoneresponse(ipaddr,port,5);\nif (zone3 == 0 or zone3 == 1) then\n  fibaro:debug(\"Zone Status:\"..zone3)\n  local zone3state = zone3\n  if zone3state == 0 then\n    fibaro:call(thisId, \"setProperty\", \"ui.balconyId.value\",\"Closed\")\n    fibaro:debug(\"Zone 3 Balcony Door is Closed\")\n  elseif zone3state == 1 then\n    fibaro:call(thisId, \"setProperty\", \"ui.balconyId.value\",\"Opened\")\n    fibaro:debug(\"Zone 3 Balcony Door is Opened\")\n  end\nelse\n  fibaro:debug('[ERROR] Invalid JSON:' .. tostring(zone3))\nend\n\n\n\n--Zone4\nzone4= zoneresponse(ipaddr,port,6);\nif (zone4 == 0 or zone4 == 1) then \n  fibaro:debug(\"Zone Status:\"..zone4)\n  local zone4state = zone4\n  if zone4state == 0 then\n    fibaro:call(thisId, \"setProperty\", \"ui.kitchedId.value\",\"Closed\")\n    fibaro:debug(\"Zone 4 Kitchen Door is Closed\")\n  elseif zone4state == 1 then\n    fibaro:call(thisId, \"setProperty\", \"ui.kitchedId.value\",\"Opened\")\n    fibaro:debug(\"Zone 4 Kitchen Door is Opened\")\n  end\nelse\n  fibaro:debug('[ERROR] Invalid JSON:' .. tostring(zone4))\nend\n\n\n\n--Zone5\nzone5= zoneresponse(ipaddr,port,7);\nif (zone5 == 0 or zone5 == 1) then\n  fibaro:debug(\"Zone Status:\"..zone5)\n  local zone5state = zone5\n  if zone5state == 0 then\n    fibaro:call(thisId, \"setProperty\", \"ui.bedId.value\",\"Closed\")\n    fibaro:debug(\"Zone 5 Bedroom Door is Closed\")\n  elseif zone5state == 1 then\n    fibaro:call(thisId, \"setProperty\", \"ui.bedId.value\",\"Opened\")\n    fibaro:debug(\"Zone 5 Bedroom Door is Opened\")\n  end\nelse\n  fibaro:debug('[ERROR] Invalid JSON:' .. tostring(zone5))\nend\n\n\n--Zone6\nzone6= zoneresponse(ipaddr,port,9);\nif (zone6 == 0 or zone6 == 1) then\n  fibaro:debug(\"Zone Status:\"..zone6)\n  local zone6state = zone6\n  if zone6state == 0 then\n    fibaro:call(thisId, \"setProperty\", \"ui.winId.value\",\"Closed\")\n    fibaro:debug(\"Zone 6 WC Window is Closed\")\n  elseif zone6state == 1 then\n    fibaro:call(thisId, \"setProperty\", \"ui.winId.value\",\"Opened\")\n    fibaro:debug(\"Zone 6 WC Window is Opened\")\n  end\nelse\n  fibaro:debug('[ERROR] Invalid JSON:' .. tostring(zone6))\nend\n\n\nfibaro:sleep(3000);","ui.balconyId.value":"Closed","ui.bedId.value":"Closed","ui.doorId.value":"Closed","ui.dtime.value":"Wed Feb 13 03:08:55 2019","ui.kitchedId.value":"Closed","ui.motionId.value":"Idle","ui.winId.value":"Closed","visible":"true","rows":[{"type":"label","elements":[{"id":1,"lua":false,"waitForResponse":false,"caption":"Door","name":"doorId","favourite":false,"main":false}]},{"type":"label","elements":[{"id":2,"lua":false,"waitForResponse":false,"caption":"Motion","name":"motionId","favourite":false,"main":false}]},{"type":"label","elements":[{"id":3,"lua":false,"waitForResponse":false,"caption":"Balcony","name":"balconyId","favourite":false,"main":false}]},{"type":"label","elements":[{"id":4,"lua":false,"waitForResponse":false,"caption":"Kitchen","name":"kitchedId","favourite":false,"main":false}]},{"type":"label","elements":[{"id":5,"lua":false,"waitForResponse":false,"caption":"Bedrooms","name":"bedId","favourite":false,"main":false}]},{"type":"label","elements":[{"id":6,"lua":false,"waitForResponse":false,"caption":"WC Window","name":"winId","favourite":false,"main":false}]},{"type":"label","elements":[{"id":7,"lua":false,"waitForResponse":false,"caption":"Datetime","name":"dtime","favourite":false,"main":false}]}]},"actions":{"pressButton":1,"setSlider":2,"setProperty":2}}